<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=0.8, maximum-scale=1.0, user-scalable=no">
    <link rel="stylesheet" href="styles.css">
    <script src="script.js" defer></script>
    <title>üíñ –õ–∏–∑–∞ —Å–∫–∞–∑–∞–ª–∞ –î–∞! üíñ</title>
</head>
<body>
    <!-- Confetti Canvas -->
    <canvas id="confettiCanvas"></canvas>

    <!-- Floating Background -->
    <div class="floating-bg" id="floatingBg"></div>

    <!-- Decorative Elements -->
    <div class="decoration deco-1">üß∏</div>
    <div class="decoration deco-2">üå∏</div>
    <div class="decoration deco-3">üíê</div>
    <div class="decoration deco-4">üß∏</div>
    <div class="decoration deco-5">üå∫</div>
    <div class="decoration deco-6">üå∑</div>

    <!-- Main Content -->
    <div class="celebration-container">
        <div class="mega-heart" id="megaHeart" onclick="handleInteraction(event, 'heart')">üíñ</div>
        
        <div class="main-message">
            <h1 class="yay-text">
                –£–†–ê–ê–ê! üéâ
                <span class="name-celebrate">–õ–∏–∑–∞ —Å–∫–∞–∑–∞–ª–∞ ¬´–î–ê¬ª!</span>
            </h1>
            <p class="sub-message">–¢—ã —Å–¥–µ–ª–∞–ª–∞ –º–µ–Ω—è —Å–∞–º—ã–º —Å—á–∞—Å—Ç–ª–∏–≤—ã–º —á–µ–ª–æ–≤–µ–∫–æ–º –Ω–∞ —Å–≤–µ—Ç–µ! üíï</p>
        </div>

        <div class="love-card">
            <span class="corner-deco corner-tl">ü¶ã</span>
            <span class="corner-deco corner-tr">ü¶ã</span>
            <span class="corner-deco corner-bl">‚ú®</span>
            <span class="corner-deco corner-br">‚ú®</span>
            
            <h2 class="love-title">üíå –ú–æ—è –¥–æ—Ä–æ–≥–∞—è –õ–∏–∑–∞ üíå</h2>
            
            <div class="love-text">
                <p>–° —Ç–æ–≥–æ —Å–∞–º–æ–≥–æ –º–æ–º–µ–Ω—Ç–∞, –∫–∞–∫ —è –≤—Å—Ç—Ä–µ—Ç–∏–ª —Ç–µ–±—è, —è –ø–æ–Ω—è–ª, —á—Ç–æ —Ç—ã –æ—Å–æ–±–µ–Ω–Ω–∞—è. –ö–∞–∂–¥—ã–π –¥–µ–Ω—å —Å —Ç–æ–±–æ–π –∫–∞–∂–µ—Ç—Å—è –ø—Ä–µ–∫—Ä–∞—Å–Ω—ã–º –ø—Ä–∏–∫–ª—é—á–µ–Ω–∏–µ–º, –∏ —è —É–∂–µ –Ω–µ –ø—Ä–µ–¥—Å—Ç–∞–≤–ª—è—é —Å–≤–æ—é –∂–∏–∑–Ω—å –±–µ–∑ —Ç–≤–æ–µ–π —É–ª—ã–±–∫–∏, —Ç–≤–æ–µ–≥–æ —Å–º–µ—Ö–∞ –∏ —Ç–≤–æ–µ–π –ª—é–±–≤–∏.</p>
    
                <p>–¢—ã –ø—Ä–µ–≤—Ä–∞—â–∞–µ—à—å –∫–∞–∂–¥—ã–π –æ–±—ã—á–Ω—ã–π –º–∏–≥ –≤ <span class="highlight">–Ω–µ–æ–±—ã–∫–Ω–æ–≤–µ–Ω–Ω—ã–π</span>, –∏ —Å –∫–∞–∂–¥—ã–º –¥–Ω–µ–º —è –≤–ª—é–±–ª—è—é—Å—å –≤ —Ç–µ–±—è –≤—Å—ë —Å–∏–ª—å–Ω–µ–µ. –°–ø–∞—Å–∏–±–æ –∑–∞ —Ç–æ, —á—Ç–æ —Ç—ã –µ—Å—Ç—å ‚Äî –º–æ–π –ª—É—á—à–∏–π –¥—Ä—É–≥, –º–æ—è –ø–æ–¥–¥–µ—Ä–∂–∫–∞ –∏ –º–æ—è –µ–¥–∏–Ω—Å—Ç–≤–µ–Ω–Ω–∞—è –í–∞–ª–µ–Ω—Ç–∏–Ω–∫–∞. üí´</p>
    
                <p>–ó–∞ –Ω–∞—Å, –∑–∞ –Ω–∞—à—É –ª—é–±–æ–≤—å –∏ –∑–∞ –±–µ—Å–∫–æ–Ω–µ—á–Ω–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —á—É–¥–µ—Å–Ω—ã—Ö –º–æ–º–µ–Ω—Ç–æ–≤, –∫–æ—Ç–æ—Ä—ã–µ –∂–¥—É—Ç –Ω–∞—Å –≤–ø–µ—Ä–µ–¥–∏! üíï</p>
    
                <p class="signature">–ù–∞–≤—Å–µ–≥–¥–∞ –∏ —Ç–æ–ª—å–∫–æ —Ç–≤–æ–π, ‚ù§Ô∏è<br>–¢–≤–æ–π –í–∞–ª–µ–Ω—Ç–∏–Ω</p>
            </div>
        </div>

        <!-- Interactive Buttons -->
        <div class="buttons-row">
            <button class="action-btn" onclick="handleInteraction(event, 'confetti')">üéâ –ë–æ–ª—å—à–µ –∫–æ–Ω—Ñ–µ—Ç—Ç–∏!</button>
            <button class="action-btn secondary" onclick="handleInteraction(event, 'hug')">ü§ó –û—Ç–ø—Ä–∞–≤–∏—Ç—å –æ–±–Ω–∏–º–∞—à–∫—É!</button>
        </div>

        <!-- Love Jar Section -->
        <div class="love-jar-section">
            <h3 class="love-jar-title">‚ú® –ù–∞–∂–º–∏ –Ω–∞ –±–∞–Ω–æ—á–∫—É, —á—Ç–æ–±—ã —É–∑–Ω–∞—Ç—å, –ø–æ—á–µ–º—É —è —Ç–µ–±—è –ª—é–±–ª—é! ‚ú®</h3>
            <div class="love-jar-container">
                <div class="love-jar" onclick="handleInteraction(event, 'jar')">üè∫</div>
            </div>
            <p class="jar-hint">–ö–∞–∂–¥–æ–µ –Ω–∞–∂–∞—Ç–∏–µ –æ—Ç–∫—Ä—ã–≤–∞–µ—Ç –ø—Ä–∏—á–∏–Ω—É –∏ –∑–∞–ø–æ–ª–Ω—è–µ—Ç —à–∫–∞–ª—É –ª—é–±–≤–∏! üíï</p>
        </div>

        <!-- Love Meter - MORPHING INFINITY -->
        <div class="love-meter-section">
            <p class="love-meter-title">üíï –ù–∞—à–∞ —à–∫–∞–ª–∞ –ª—é–±–≤–∏ üíï</p>
            
            <div class="love-meter-wrapper">
                <!-- Regular Bar -->
                <div class="love-meter-container" id="loveMeterContainer" onclick="handleInteraction(event, 'meter')">
                    <div class="love-meter-fill" id="loveMeterFill"></div>
                </div>

                <!-- Infinity Symbol (Hidden by default) -->
                <div class="infinity-container" id="infinityContainer">
                    <span class="infinity-sparkle">‚ú®</span>
                    <span class="infinity-sparkle">üíñ</span>
                    <span class="infinity-sparkle">‚ú®</span>
                    <span class="infinity-sparkle">üíñ</span>
                    
                    <div class="infinity-svg-wrapper">
                            <svg viewBox="0 0 200 80" xmlns="http://www.w3.org/2000/svg">
                                <defs>
                                    <linearGradient id="infinityGradient" x1="0%" y1="0%" x2="100%" y2="0%">
                                        <stop offset="0%" stop-color="#ff69b4">
                                            <animate attributeName="stop-color" values="#ff69b4;#ff1493;#a855f7;#ffd700;#ff69b4" dur="3s" repeatCount="indefinite"/>
                                        </stop>
                                        <stop offset="50%" stop-color="#a855f7">
                                            <animate attributeName="stop-color" values="#a855f7;#ffd700;#ff69b4;#ff1493;#a855f7" dur="3s" repeatCount="indefinite"/>
                                        </stop>
                                        <stop offset="100%" stop-color="#ff69b4">
                                            <animate attributeName="stop-color" values="#ff69b4;#ff1493;#a855f7;#ffd700;#ff69b4" dur="3s" repeatCount="indefinite"/>
                                        </stop>
                                    </linearGradient>
                                </defs>
        
                                <path class="infinity-path infinity-path-bg" 
                                    d="M100,40 C100,40 130,10 160,10 C190,10 190,70 160,70 C130,70 100,40 100,40 C100,40 70,10 40,10 C10,10 10,70 40,70 C70,70 100,40 100,40"/>
        
                                <path class="infinity-path infinity-path-fill" 
                                    d="M100,40 C100,40 130,10 160,10 C190,10 190,70 160,70 C130,70 100,40 100,40 C100,40 70,10 40,10 C10,10 10,70 40,70 C70,70 100,40 100,40"/>
                        </svg>
                    </div>
                </div>
            </div>
            
            <p class="love-meter-text" id="loveMeterText">–î–∞—Ä–∏ –ª—é–±–æ–≤—å –∫–∞–∂–¥—ã–º –∫–∞—Å–∞–Ω–∏–µ–º! ‚ù§Ô∏è</p>
        </div>

        <!-- Countdown -->
        <div class="countdown-section" id="countdownSection">
            <p class="countdown-title">‚è∞ Countdown to Valentine's Day 2025 ‚è∞</p>
            <div class="countdown" id="countdown">
                <div class="countdown-item">
                    <div class="countdown-number" id="days">00</div>
                    <div class="countdown-label">Days</div>
                </div>
                <div class="countdown-item">
                    <div class="countdown-number" id="hours">00</div>
                    <div class="countdown-label">Hours</div>
                </div>
                <div class="countdown-item">
                    <div class="countdown-number" id="minutes">00</div>
                    <div class="countdown-label">Minutes</div>
                </div>
                <div class="countdown-item">
                    <div class="countdown-number" id="seconds">00</div>
                    <div class="countdown-label">Seconds</div>
                </div>
            </div>
        </div>
    </div>

    <!-- Overlay for popups -->
    <div class="overlay" id="overlay" onclick="closeLoveNote()"></div>

    <!-- Love Note Popup -->
    <div class="love-note-popup" id="loveNotePopup">
        <div class="note-emoji" id="noteEmoji">üíï</div>
        <p class="note-number" id="noteNumber">–ü—Ä–∏—á–∏–Ω–∞ #1</p>
        <p class="note-text" id="noteText">–ó–∞–≥—Ä—É–∑–∫–∞...</p>
        <button class="close-note-btn" onclick="closeLoveNote()">–ë–æ–ª—å—à–µ –õ—é–±–≤–∏! üíñ</button>
    </div>

    <!-- Virtual Hug Animation - GIF VERSION -->
    <div class="hug-animation" id="hugAnimation">
        <!-- Floating hearts around the GIF -->
        <div class="hug-hearts">
            <span class="hug-heart">üíï</span>
            <span class="hug-heart">üíñ</span>
            <span class="hug-heart">üíó</span>
            <span class="hug-heart">üíì</span>
            <span class="hug-heart">üíù</span>
            <span class="hug-heart">ü§ó</span>
        </div>
        <img src="GomaHug.gif" alt="Virtual Hug" class="hug-gif">
    </div>
    <div class="hug-message" id="hugMessage">–û—Ç–ø—Ä–∞–≤–ª—è—é —Ç–µ–±–µ —Å–∞–º—ã–µ –∫—Ä–µ–ø–∫–∏–µ –≤–∏—Ä—Ç—É–∞–ª—å–Ω—ã–µ –æ–±—ä—è—Ç–∏—è, –õ–∏–∑–∞! ü§óüíñ</div>

    <!-- Background Music -->
    <audio id="bgMusic" loop preload="metadata" crossorigin="anonymous">
        <source src="./Cupid.mp3" type="audio/mpeg">
        <source src="Cupid.mp3" type="audio/mpeg">
    </audio>

    <!-- Music Control Button -->
    <button id="musicToggle" class="music-btn">üéµ</button>

    <!-- ========== MUSIC CONTROLLER ========== -->
    <script>
        const music = document.getElementById('bgMusic');
        const musicBtn = document.getElementById('musicToggle');
        let isMusicPlaying = false;
        let hasMusicInteracted = false;

        // Music settings
        music.volume = 0.4;
        const startTime = 9; // Start from 9 seconds

        // Create visualizer bars
        const barsContainer = document.createElement('div');
        barsContainer.className = 'music-bars';
        for (let i = 0; i < 4; i++) {
            const bar = document.createElement('div');
            bar.className = 'music-bar';
            barsContainer.appendChild(bar);
        }
        musicBtn.innerHTML = '';
        musicBtn.appendChild(document.createTextNode('üéµ'));

        // Function to start music
        function startMusic() {
            music.currentTime = startTime;
            music.play().then(() => {
                isMusicPlaying = true;
                hasMusicInteracted = true;
                updateMusicButton();
            }).catch(err => {
                console.log('Music play failed:', err);
            });
        }

        // Function to update button appearance
        function updateMusicButton() {
            if (isMusicPlaying) {
                musicBtn.innerHTML = '';
                musicBtn.appendChild(barsContainer.cloneNode(true));
                musicBtn.classList.add('playing');
            } else {
                musicBtn.innerHTML = 'üéµ';
                musicBtn.classList.remove('playing');
            }
        }

        // Toggle music function
        function toggleMusic(e) {
            e.stopPropagation();
            
            if (!hasMusicInteracted) {
                startMusic();
                return;
            }

            if (isMusicPlaying) {
                music.pause();
                isMusicPlaying = false;
            } else {
                music.currentTime = startTime;
                music.play();
                isMusicPlaying = true;
            }
            updateMusicButton();
        }

        // Button click handler
        musicBtn.addEventListener('click', toggleMusic);

        // All possible interaction events for autoplay
        const interactionEvents = [
            'click',
            'touchstart',
            'mousemove',
            'scroll',
            'keydown'
        ];

        // Handler for first interaction
        function onFirstInteraction(e) {
            if (hasMusicInteracted) return;
            if (e.target.id === 'musicToggle') return;
            
            startMusic();
            removeInteractionListeners();
        }

        // Add interaction listeners
        function addInteractionListeners() {
            interactionEvents.forEach(event => {
                document.addEventListener(event, onFirstInteraction, { passive: true });
            });
        }

        // Remove interaction listeners
        function removeInteractionListeners() {
            interactionEvents.forEach(event => {
                document.removeEventListener(event, onFirstInteraction);
            });
        }

        // Audio error handling
        music.addEventListener('error', (e) => {
            console.error('Audio error:', e);
            console.error('Audio error code:', music.error?.code);
            console.error('Audio error message:', music.error?.message);
        });

        music.addEventListener('loadeddata', () => {
            console.log('Audio loaded successfully');
        });

        // Try autoplay first
        music.currentTime = startTime;
        music.play().then(() => {
            isMusicPlaying = true;
            hasMusicInteracted = true;
            updateMusicButton();
            removeInteractionListeners();
        }).catch((err) => {
            console.log('üéµ Autoplay blocked:', err.message);
            console.log('üéµ Waiting for interaction to play music...');
            addInteractionListeners();
        });

        // Handle page visibility (pause when tab hidden)
        document.addEventListener('visibilitychange', () => {
            if (!hasMusicInteracted) return;
            
            if (document.hidden && isMusicPlaying) {
                music.pause();
            } else if (!document.hidden && isMusicPlaying) {
                music.play();
            }
        });

        // When song loops, restart from 9 seconds
        music.addEventListener('ended', () => {
            music.currentTime = startTime;
            music.play();
        });

        // Double-check loop reset
        music.addEventListener('timeupdate', () => {
            if (music.duration - music.currentTime < 0.5) {
                music.currentTime = startTime;
            }
        });
    </script>
</body>
</html>